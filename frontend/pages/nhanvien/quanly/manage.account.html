<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Qu·∫£n l√Ω t√†i kho·∫£n - DHST Hospital</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
  :root{
    --primary:#2563eb; --accent:#38bdf8; --bg:#f9fafb; --card:#fff;
    --text:#1e293b; --muted:#6b7280; --radius:14px; --shadow:0 10px 30px rgba(0,0,0,0.08);
  }
  *{box-sizing:border-box;font-family:"Inter",sans-serif;margin:0;padding:0;}
  body{display:flex;min-height:100vh;background:var(--bg);color:var(--text);}
  
  /* Sidebar */
  .sidebar{
    width:240px;background:#1e293b;color:#fff;display:flex;flex-direction:column;
    justify-content:space-between;
    padding:24px 16px;box-shadow:2px 0 8px rgba(0,0,0,0.1);
  }
  .brand{font-size:22px;font-weight:700;margin-bottom:30px;text-align:center;display:flex;align-items:center;justify-content:center;gap:10px;}
  .nav a{
    display:flex;align-items:center;gap:10px;color:#cbd5e1;
    text-decoration:none;padding:12px 14px;border-radius:10px;transition:all .25s;
  }
.submenu-group { display:flex; flex-direction:column; }
.submenu { display:none; flex-direction:column; margin-left:24px; margin-top:4px; }
.submenu a {
  font-size:14px; color:#cbd5e1; padding:10px 12px;
  border-radius:8px; transition:all .25s;
}
.submenu a:hover { background:rgba(255,255,255,0.1); color:#fff; transform:translateX(4px); }
.submenu.show { display:flex; }

  .nav a:hover,.nav a.active{background:var(--primary);color:#fff;transform:translateX(4px);}
  .nav a i{width:20px;text-align:center;}

  /* üîπ N√∫t ƒëƒÉng xu·∫•t */
  .logout {
    margin-top:20px;
  }
  .logout button {
    width:100%;
    background:#ef4444;
    color:#fff;
    border:none;
    border-radius:10px;
    padding:10px 14px;
    font-weight:600;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    transition:all .25s;
  }
  .logout button:hover {
    background:#dc2626;
    transform:translateY(-2px);
  }

  /* Main */
  .main{flex:1;padding:32px;overflow:auto;}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:28px;}
  header h1{font-size:26px;font-weight:700;color:var(--primary);display:flex;align-items:center;gap:10px;}
  header .small{color:var(--muted);}
  
  /* Card */
  .card{
    background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
    padding:26px;margin-bottom:30px;animation:fadeIn .4s ease;
  }
  .card h2{font-size:18px;margin-bottom:18px;display:flex;align-items:center;gap:10px;color:var(--text);}
  .card h2 i{color:var(--primary);}
  
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:none;}}
  
  /* Form */
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
  label{font-weight:600;font-size:14px;margin-bottom:6px;display:block;color:var(--text);}
  input,select{
    width:100%;padding:12px 14px;border:1px solid #e2e8f0;border-radius:10px;
    font-size:14px;transition:border .2s,box-shadow .2s;
  }
  input:focus,select:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.15);outline:none;}
  .btn{
    background:var(--primary);color:#fff;padding:12px 20px;border:none;
    border-radius:10px;font-weight:600;cursor:pointer;transition:all .25s;
  }
  .btn:hover{opacity:.9;transform:translateY(-2px);}
  
  /* Table */
  .table-wrap{overflow-x:auto;}
  table{width:100%;border-collapse:collapse;margin-top:10px;}
  thead th{
    background:linear-gradient(90deg,var(--primary),#1e40af);color:#fff;
    padding:12px 16px;text-align:left;font-weight:600;
  }
  tbody td{padding:12px 16px;border-bottom:1px solid #f1f5f9;}
  tr:hover td{background:#f8fafc;}
  .pill{display:inline-block;padding:6px 14px;border-radius:999px;color:#fff;font-weight:600;font-size:13px;}
  .pill.active{background:#16a34a;}
  .pill.inactive{background:#ef4444;}
  
  /* Toast */
  .toast-wrap{position:fixed;right:24px;top:24px;z-index:90;display:flex;flex-direction:column;gap:10px;}
  .toast{
    background:#fff;padding:12px 16px;border-left:6px solid;border-radius:12px;
    box-shadow:var(--shadow);animation:fadeIn .4s ease;
  }
  .toast.success{border-color:#16a34a;}
  .toast.error{border-color:#ef4444;}
  
  /* Modal */
  .overlay{
    position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;
    align-items:center;justify-content:center;z-index:80;animation:fadeIn .3s ease;
  }
  .overlay.show{display:flex;}
  .modal{
    background:#fff;border-radius:16px;padding:26px;min-width:320px;
    max-width:480px;box-shadow:0 20px 45px rgba(0,0,0,0.2);animation:scaleIn .3s ease;
  }
  @keyframes scaleIn{from{opacity:0;transform:scale(.9);}to{opacity:1;transform:scale(1);}}
  .modal h3{margin-bottom:10px;font-size:18px;display:flex;align-items:center;gap:8px;color:var(--text);}
  .modal p{font-size:14px;color:var(--muted);margin-bottom:16px;}
  .modal .actions{display:flex;justify-content:flex-end;gap:10px;}
  .btn-secondary{background:#94a3b8;}
  .btn-danger{background:#ef4444;}
  
  .confirm-icon{
    width:52px;height:52px;border-radius:50%;background:#fef2f2;
    color:#ef4444;display:flex;align-items:center;justify-content:center;
    font-size:24px;margin:0 auto 14px;
  }

  @media (max-width:900px){.grid{grid-template-columns:1fr;}.sidebar{display:none;}.main{padding:20px;}}
</style>
</head>
<body>
  <aside class="sidebar">
    <div>
      <div class="brand"><i class="fas fa-hospital"></i> DHST Hospital</div>
      <nav class="nav">
        <a class="active" href="#"><i class="fas fa-user-cog"></i> Qu·∫£n l√Ω t√†i kho·∫£n</a>
        <div class="submenu-group">
          <a href="#" id="toggleNhanVien"><i class="fas fa-user-friends"></i> Qu·∫£n l√Ω th√¥ng tin nh√¢n vi√™n 
            <i class="fas fa-chevron-down" style="margin-left:auto;font-size:12px;"></i>
          </a>
          <div id="submenuNhanVien" class="submenu">
            <a href="manage.bacsi.html"><i class="fas fa-user-md"></i> Qu·∫£n l√Ω b√°c sƒ©</a>
            <a href="manage.letan.html"><i class="fas fa-concierge-bell"></i> Qu·∫£n l√Ω l·ªÖ t√¢n</a>
          </div>
        </div>
        <a href="manage.lichlamviec.html"><i class="fas fa-calendar-alt"></i> Qu·∫£n l√Ω l·ªãch l√†m vi·ªác</a>
        <a href="manage.news.html"><i class="fas fa-newspaper"></i> Qu·∫£n l√Ω b√†i vi·∫øt</a>
      </nav>
    </div>
    <!-- ‚úÖ N√∫t ƒëƒÉng xu·∫•t -->
    <div class="logout">
      <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</button>
    </div>
  </aside>

  <main class="main">
    <header>
      <h1><i class="fas fa-users"></i> Qu·∫£n l√Ω t√†i kho·∫£n</h1>
      <div class="small">Xin ch√†o, Admin üëã</div>
    </header>

    <!-- Form -->
    <section class="card">
      <h2><i class="fas fa-user-plus"></i> T·∫°o t√†i kho·∫£n m·ªõi</h2>
      <div class="grid" style="margin-bottom:16px">
        <div><label>H·ªç & t√™n</label><input id="fullname" placeholder="Nguy·ªÖn VƒÉn A"></div>
        <div><label>T√™n ƒëƒÉng nh·∫≠p</label><input id="username" placeholder="username123"></div>
        <div><label>S·ªë ƒëi·ªán tho·∫°i</label><input id="phone" placeholder="09xxxxxxxx"></div>
        <div><label>Email</label><input id="email" type="email" placeholder="email@domain.com"></div>
        <div>
          <label>Vai tr√≤</label>
          <select id="role">
            <option value="">-- Ch·ªçn vai tr√≤ --</option>
            <option value="BACSI">B√°c sƒ©</option>
            <option value="LETAN">L·ªÖ t√¢n</option>
          </select>
        </div>
        <div id="khoaWrap" style="display:none">
          <label>Ch·ªçn khoa</label>
          <select id="khoa"><option value="">ƒêang t·∫£i...</option></select>
        </div>
      </div>
      <button id="createBtn" class="btn"><i class="fas fa-plus-circle"></i> T·∫°o t√†i kho·∫£n</button>
      <span id="btnSpinner" style="display:none;margin-left:10px;color:var(--primary);font-weight:600;">ƒêang g·ª≠i...</span>
    </section>

    <!-- Danh s√°ch -->
    <section class="card">
<h2 style="display:flex;justify-content:space-between;align-items:center;">
  <span><i class="fas fa-list"></i> Danh s√°ch t√†i kho·∫£n</span>
  <div style="display:flex;align-items:center;gap:8px;">
    <input id="searchInput" type="text" placeholder="üîç T√¨m theo m√£ ho·∫∑c t√™n..."
      style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:10px;font-size:14px;width:240px;">
    <button id="clearSearch" class="btn" style="background:#94a3b8;"><i class="fas fa-times"></i></button>
  </div>
</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th style="width:80px">M√£ NV</th>
              <th>H·ªç t√™n</th>
              <th>T√™n ƒëƒÉng nh·∫≠p</th>
              <th style="width:110px">Ch·ª©c v·ª•</th>
              <th style="width:140px">Tr·∫°ng th√°i</th>
            </tr>
          </thead>
          <tbody id="accountsTbody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div id="overlay" class="overlay">
    <div class="modal" id="modalBox">
      <div id="confirmSection" style="display:none;text-align:center;">
        <div class="confirm-icon"><i class="fas fa-triangle-exclamation"></i></div>
        <h3>X√°c nh·∫≠n h√†nh ƒë·ªông</h3>
        <p id="confirmMsg"></p>
        <div class="actions">
          <button id="confirmCancel" class="btn btn-secondary">H·ªßy</button>
          <button id="confirmOk" class="btn btn-danger">X√°c nh·∫≠n</button>
        </div>
      </div>
      <div id="infoSection">
        <h3><i class="fas fa-info-circle"></i> <span id="modalTitle">Th√¥ng b√°o</span></h3>
        <p id="modalMsg"></p>
        <div class="actions"><button id="modalClose" class="btn btn-secondary">ƒê√≥ng</button></div>
      </div>
    </div>
  </div>

  <div id="toasts" class="toast-wrap"></div>

<script>
  // ================= C·∫§U H√åNH API =================
  const API_BASE = "http://localhost:3000";
  const API_USERS = API_BASE + "/api/users";
  const API_ACCOUNTS = API_BASE + "/api/accounts";
  const API_KHOA = API_BASE + "/api/khoa";

  // ================= BI·∫æN DOM =================
  const elFull = document.getElementById("fullname");
  const elUser = document.getElementById("username");
  const elPhone = document.getElementById("phone");
  const elEmail = document.getElementById("email");
  const elRole = document.getElementById("role");
  const elKhoaWrap = document.getElementById("khoaWrap");
  const elKhoa = document.getElementById("khoa");
  const btnCreate = document.getElementById("createBtn");
  const spinner = document.getElementById("btnSpinner");
  const accountsTbody = document.getElementById("accountsTbody");

  const overlay = document.getElementById("overlay");
  const modalTitle = document.getElementById("modalTitle");
  const modalMsg = document.getElementById("modalMsg");
  const modalClose = document.getElementById("modalClose");
  const confirmSection = document.getElementById("confirmSection");
  const infoSection = document.getElementById("infoSection");
  const confirmMsg = document.getElementById("confirmMsg");
  const confirmCancel = document.getElementById("confirmCancel");
  const confirmOk = document.getElementById("confirmOk");
  const toasts = document.getElementById("toasts");

  const searchInput = document.getElementById("searchInput");
  const clearSearch = document.getElementById("clearSearch");

  let allAccounts = [];

  // ================= TOAST =================
  function showToast(text, type = "success", ms = 3000) {
    const t = document.createElement("div");
    t.className = "toast " + (type === "success" ? "success" : "error");
    t.innerHTML = `<strong>${type === "success" ? "Th√†nh c√¥ng" : "L·ªói"}</strong>
      <div style="font-size:13px;margin-top:4px;">${text}</div>`;
    toasts.appendChild(t);
    setTimeout(() => (t.style.opacity = 0), ms - 600);
    setTimeout(() => t.remove(), ms);
  }

  // ================= MODAL =================
  function openModal(title, msg, extraHTML = "") {
    infoSection.style.display = "block";
    confirmSection.style.display = "none";
    modalTitle.textContent = title;
    modalMsg.innerHTML = msg + (extraHTML ? `<div style="margin-top:14px;">${extraHTML}</div>` : "");
    overlay.classList.add("show");
  }

  function openConfirm(msg, callback) {
    confirmSection.style.display = "block";
    infoSection.style.display = "none";
    confirmMsg.textContent = msg;
    overlay.classList.add("show");
    confirmOk.onclick = () => {
      closeModal();
      callback(true);
    };
    confirmCancel.onclick = () => {
      closeModal();
      callback(false);
    };
  }

  function closeModal() {
    overlay.classList.remove("show");
  }

  modalClose.onclick = closeModal;
  overlay.onclick = (e) => {
    if (e.target === overlay) closeModal();
  };

  // ================= LOAD KHOA =================
  async function loadKhoa() {
    try {
      const r = await fetch(API_KHOA);
      const data = await r.json();
      elKhoa.innerHTML = '<option value="">-- Ch·ªçn khoa --</option>';
      if (Array.isArray(data)) {
        data.forEach((k) => {
          const id = k.id_khoa || k.id;
          const name = k.ten_khoa || k.name;
          elKhoa.insertAdjacentHTML("beforeend", `<option value="${id}">${name}</option>`);
        });
      }
    } catch {
      elKhoa.innerHTML = '<option value="">(L·ªói t·∫£i khoa)</option>';
    }
  }

  // ================= LOAD DANH S√ÅCH =================
  async function loadAccounts() {
    try {
      const r = await fetch(API_ACCOUNTS);
      const data = await r.json();
      allAccounts = Array.isArray(data) ? data : [];
      renderAccounts(allAccounts);
    } catch {
      accountsTbody.innerHTML = "<tr><td colspan='5' style='color:red'>L·ªói t·∫£i d·ªØ li·ªáu</td></tr>";
    }
  }

  function renderAccounts(list) {
    accountsTbody.innerHTML = "";
    if (!list.length) {
      accountsTbody.innerHTML = "<tr><td colspan='5' style='color:#999'>Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n</td></tr>";
      return;
    }

    list.forEach((acc) => {
      const id = acc.id_taikhoan || acc.id;
      const name = acc.ho_ten || acc.name;
      const uname = acc.username || "-";
      const role = acc.role || "-";
      const status = acc.status || "INACTIVE";

      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${id}</td><td>${name}</td><td>${uname}</td><td>${role}</td>`;
      const td = document.createElement("td");
      const span = document.createElement("span");
      span.className = "pill " + (status === "ACTIVE" ? "active" : "inactive");
      span.textContent = status === "ACTIVE" ? "Ho·∫°t ƒë·ªông" : "Kh√≥a";

      span.onclick = () => {
        openConfirm(`B·∫°n c√≥ ch·∫Øc mu·ªën ${status === "ACTIVE" ? "kh√≥a" : "m·ªü kh√≥a"} t√†i kho·∫£n n√†y?`, async (ok) => {
          if (!ok) return;
          try {
            const res = await fetch(API_ACCOUNTS + "/" + id + "/status", {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                status: status === "ACTIVE" ? "INACTIVE" : "ACTIVE",
              }),
            });
            if (res.ok) showToast("C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng");
            else showToast("C·∫≠p nh·∫≠t th·∫•t b·∫°i", "error");
            await loadAccounts();
          } catch {
            showToast("L·ªói k·∫øt n·ªëi m√°y ch·ªß", "error");
          }
        });
      };

      td.appendChild(span);
      tr.appendChild(td);
      accountsTbody.appendChild(tr);
    });
  }

  // ================= T√åM KI·∫æM =================
  searchInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      const keyword = searchInput.value.trim().toLowerCase();
      if (!keyword) {
        renderAccounts(allAccounts);
        showToast("Vui l√≤ng nh·∫≠p t√™n ƒë·ªÉ t√¨m ki·∫øm", "error");
        return;
      }
      const filtered = allAccounts.filter((acc) =>
        (acc.ho_ten || acc.name || "").toLowerCase().includes(keyword)
      );
      renderAccounts(filtered);
      if (!filtered.length) showToast("Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n ph√π h·ª£p", "error");
    }
  });

  clearSearch.onclick = () => {
    searchInput.value = "";
    renderAccounts(allAccounts);
  };

  // ================= FORM T·∫†O T√ÄI KHO·∫¢N =================
  elRole.onchange = () => (elKhoaWrap.style.display = elRole.value === "BACSI" ? "" : "none");

  // Th√™m n√∫t "H·ªßy"
  const cancelBtn = document.createElement("button");
  cancelBtn.className = "btn btn-secondary";
  cancelBtn.style.marginLeft = "10px";
  cancelBtn.innerHTML = `<i class="fas fa-times"></i> H·ªßy`;
  btnCreate.insertAdjacentElement("afterend", cancelBtn);

  cancelBtn.onclick = () => {
    openConfirm("B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy? Th√¥ng tin ch∆∞a l∆∞u s·∫Ω b·ªã m·∫•t.", (ok) => {
      if (ok) {
        [elFull, elUser, elPhone, elEmail, elRole, elKhoa].forEach((el) => (el.value = ""));
        elKhoaWrap.style.display = "none";
        showToast("ƒê√£ h·ªßy thao t√°c t·∫°o t√†i kho·∫£n");
      }
    });
  };

  btnCreate.onclick = async () => {
    const hoten = elFull.value.trim();
    const username = elUser.value.trim();
    const phone = elPhone.value.trim();
    const email = elEmail.value.trim();
    const role = elRole.value;
    const id_khoa = role === "BACSI" ? elKhoa.value || null : null;

    // 1Ô∏è‚É£ B·∫Øt bu·ªôc nh·∫≠p
    if (!hoten || !username || !email || !role || (role === "BACSI" && !id_khoa)) {
      showToast("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc (*)", "error");
      [elFull, elUser, elEmail, elRole, elKhoa].forEach((f) => {
        if (!f.value.trim()) f.style.borderColor = "red";
        else f.style.borderColor = "#e2e8f0";
      });
      return;
    }

    // 2Ô∏è‚É£ T√™n ƒëƒÉng nh·∫≠p kh√¥ng c√≥ k√Ω t·ª± ƒë·∫∑c bi·ªát
    const usernameRegex = /^[a-zA-Z0-9_]+$/;
    if (!usernameRegex.test(username)) {
      openModal("T√™n ƒëƒÉng nh·∫≠p kh√¥ng h·ª£p l·ªá", "T√™n ƒëƒÉng nh·∫≠p kh√¥ng ƒë∆∞·ª£c ch·ª©a d·∫•u c√°ch ho·∫∑c k√Ω t·ª± ƒë·∫∑c bi·ªát.");
      return;
    }

    // 3Ô∏è‚É£ Email h·ª£p l·ªá
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      openModal("Email kh√¥ng h·ª£p l·ªá", "ƒê·ªãnh d·∫°ng email kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra l·∫°i.");
      return;
    }

    // 4Ô∏è‚É£ S·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá
    const phoneRegex = /^(0[1-9][0-9]{8,9})$/;
    if (phone && !phoneRegex.test(phone)) {
      openModal("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá", "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p 10-11 ch·ªØ s·ªë.");
      elPhone.style.borderColor = "red";
      return;
    }

    // 5Ô∏è‚É£ Ki·ªÉm tra tr√πng t√™n ƒëƒÉng nh·∫≠p / email
    try {
      const r = await fetch(API_ACCOUNTS);
      const list = await r.json();
      if (Array.isArray(list)) {
        if (list.some((acc) => acc.username === username)) {
          openModal("T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i", "T√™n ƒëƒÉng nh·∫≠p ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng. Vui l√≤ng ch·ªçn t√™n kh√°c.");
          return;
        }
        if (list.some((acc) => acc.email === email)) {
          openModal("Email ƒë√£ t·ªìn t·∫°i", "Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng. Vui l√≤ng nh·∫≠p email kh√°c.");
          return;
        }
      }
    } catch {
      showToast("Kh√¥ng th·ªÉ ki·ªÉm tra t√†i kho·∫£n hi·ªán c√≥", "error");
      return;
    }

    // ‚úÖ G·ª≠i API th·∫≠t
    btnCreate.disabled = true;
    spinner.style.display = "inline";

    const payload = { username, hoten, role, status: "ACTIVE", id_khoa, phone, email };

    try {
      const res = await fetch(API_USERS, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });
      const data = await res.json();

      if (res.ok) {
        showToast("T·∫°o t√†i kho·∫£n th√†nh c√¥ng");
        await loadAccounts();

        const password = data.account?.password || "(Kh√¥ng nh·∫≠n ƒë∆∞·ª£c m·∫≠t kh·∫©u)";
        const returnedUser = data.account?.username || username;

        const html = `
          <div style="background:#f9fafb;padding:14px;border-radius:12px;border:1px solid #e5e7eb;">
            <div><strong>T√™n ƒëƒÉng nh·∫≠p:</strong> ${returnedUser}</div>
            <div><strong>M·∫≠t kh·∫©u:</strong> ${password}</div>
          </div>
          <button id="copyBtn" class="btn" style="margin-top:14px;width:100%;">
            <i class="fas fa-copy"></i> Sao ch√©p th√¥ng tin
          </button>
        `;
        openModal("T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c t·∫°o!", "H√£y g·ª≠i th√¥ng tin n√†y cho ng∆∞·ªùi d√πng:", html);

        setTimeout(() => {
          const copyBtn = document.getElementById("copyBtn");
          if (copyBtn)
            copyBtn.onclick = () => {
              navigator.clipboard.writeText(`T√™n ƒëƒÉng nh·∫≠p: ${returnedUser}\nM·∫≠t kh·∫©u: ${password}`);
              showToast("ƒê√£ sao ch√©p th√¥ng tin v√†o clipboard");
            };
        }, 300);
      } else {
        openModal("L·ªói", data.error || data.message || "Kh√¥ng th·ªÉ t·∫°o t√†i kho·∫£n");
      }
    } catch {
      openModal("L·ªói k·∫øt n·ªëi", "Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server");
    } finally {
      btnCreate.disabled = false;
      spinner.style.display = "none";
    }
  };

  // ================= KH·ªûI T·∫†O =================
  (async () => {
    await loadKhoa();
    await loadAccounts();
  })();

  // ================= SUBMENU =================
  const toggleNhanVien = document.getElementById("toggleNhanVien");
  const submenuNhanVien = document.getElementById("submenuNhanVien");
  toggleNhanVien.onclick = (e) => {
    e.preventDefault();
    submenuNhanVien.classList.toggle("show");
  };

  // ================= ƒêƒÇNG XU·∫§T =================
  const logoutBtn = document.getElementById("logoutBtn");
  logoutBtn.onclick = () => {
    if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?")) {
      localStorage.clear();
      sessionStorage.clear();
      window.location.href = "../login.html";
    }
  };
</script>
</body>
</html>
